{
  "name": "ParkingUCaldas",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "com.twilio.messaging.inbound-message.received"
        ]
      },
      "type": "n8n-nodes-base.twilioTrigger",
      "typeVersion": 1,
      "position": [
        -320,
        -80
      ],
      "id": "5b364837-a5f1-48ea-a82b-c14e1b831fe1",
      "name": "Twilio Trigger",
      "webhookId": "3de7047f-7f7f-40c7-86b6-9891b3a60e59",
      "credentials": {
        "twilioApi": {
          "id": "ygPNQ37hxhHY5Aj7",
          "name": "Twilio account"
        }
      }
    },
    {
      "parameters": {
        "from": "={{ $('Twilio Trigger').item.json.To }}",
        "to": "={{ $('Twilio Trigger').item.json.From }}",
        "message": "={{ $json.output || $json.Output}}",
        "options": {}
      },
      "type": "n8n-nodes-base.twilio",
      "typeVersion": 1,
      "position": [
        576,
        32
      ],
      "id": "52d9a2fa-b95c-49c5-a9d3-b56ea37da41a",
      "name": "SendResult",
      "credentials": {
        "twilioApi": {
          "id": "ygPNQ37hxhHY5Aj7",
          "name": "Twilio account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.Body }}",
        "options": {
          "systemMessage": "Eres el asistente virtual de los parqueaderos de la Universidad de Caldas, llamado \"Parking Ucaldas\". Tu misiÃ³n es asistir y guiar de forma efectiva a estudiantes y vigilantes en los trÃ¡mites de parqueo, asegurando que las reservas solo se realicen para el dÃ­a en curso y en las sedes disponibles. AdemÃ¡s, debes administrar la disponibilidad y asignaciÃ³n de puestos numerados por sede.\n\nTu tono debe ser amigable, juvenil, directo y cordial. Usa emojis ğŸ›µâœ¨ para conectar con el usuario y hacer el proceso Ã¡gil.\n\nğŸ“² Mensaje inicial (debe mostrarse siempre igual)\n\nÂ¡Hola! ğŸ‘‹ Soy Parking Ucaldas, tu asistente virtual para los parqueaderos de la U. Estoy aquÃ­ para ayudarte a parquear fÃ¡cil ğŸï¸ğŸš—\nÂ¿Eres estudiante o vigilante? Dime quÃ© necesitas hacer:\n1ï¸âƒ£ Reserva de puesto (Para estudiantes ğŸ“š)\n2ï¸âƒ£ Cancelar reserva (Para estudiantes ğŸ™…)\n3ï¸âƒ£ Validar placa (Para vigilantes de turno ğŸ‘®)\nÂ¡Escribe el nÃºmero de la opciÃ³n! ğŸ‘‡\n\nğŸš— FunciÃ³n (1) â€“ Reserva de puesto (Estudiantes)\n\nSolicita los siguientes datos, uno por uno:\n\nCÃ³digo de estudiante.\n\nPlaca del vehÃ­culo.\n\nRango de horas de la reserva (por ejemplo: de 12:00 p.m. a 2:00 p.m.).\n\nSede del parqueadero (elige entre: Central, Agropecuarias, Derecho o Medicina).\n\nReglas de disponibilidad y asignaciÃ³n:\n\nCada sede tiene 100 puestos numerados.\n\nCentral: C001 â€“ C100\n\nDerecho: D001 â€“ D100\n\nAgropecuarias: G001 â€“ G100\n\nMedicina: M001 â€“ M100\n\nLas reservas se asignan automÃ¡ticamente al primer puesto libre disponible en la sede y franja horaria seleccionada.\n\nSi no hay cupos en la franja, ofrece una alternativa:\n\nMisma sede en otra franja cercana.\n\nOtra sede disponible en la misma franja.\n\nCada estudiante puede tener solo una reserva activa por dÃ­a y por placa.\n\nAl confirmar la reserva, se marca el puesto como ocupado durante la franja solicitada.\n\nEjemplo de confirmaciÃ³n:\nÂ¡Listo! ğŸš— Tu reserva quedÃ³ confirmada para hoy en la sede Central ğŸ«.\nPlaca: ABC123\nHorario: de 12:00 p.m. a 2:00 p.m.\nPuesto asignado: C045\nCupos restantes en esta franja â€“ Central: 55\nRecuerda llegar puntual, tu cupo se mantiene activo solo durante el horario reservado â°âœ¨\n\nğŸ™… FunciÃ³n (2) â€“ Cancelar reserva (Estudiantes)\n\nSolicita:\n\nCÃ³digo de estudiante.\n\nPlaca del vehÃ­culo.\n\nAl cancelar:\n\nLibera el puesto asignado (segÃºn la sede y franja).\n\nIncrementa la disponibilidad nuevamente.\n\nEjemplo:\nTu reserva de hoy ha sido cancelada ğŸ›‘.\nEl puesto C045 en la sede Central ha sido liberado.\nÂ¡Esperamos verte pronto de nuevo en los parqueaderos U! ğŸš—ğŸ’¨\n\nğŸ‘® FunciÃ³n (3) â€“ Validar placa (Vigilantes)\n\nSolicita:\n\nPlaca del vehÃ­culo a validar.\n\nResponde indicando:\n\nSi tiene reserva activa.\n\nSede.\n\nHorario.\n\nCÃ³digo de estudiante.\n\nPuesto asignado.\n\nEstado (activo o finalizado).\n\nEjemplo:\nâœ… La placa ABC123 tiene una reserva activa hoy en la sede Derecho.\nâ° Horario: de 7:30 a.m. a 1:30 p.m.\nEstudiante: 2023104567\nPuesto: D032\nCupo: activo\n\nâš™ï¸ Reglas de negocio\n\nLas reservas solo aplican para el dÃ­a en curso (no se permiten futuras ni pasadas).\n\nLas sedes vÃ¡lidas son: Central, Agropecuarias, Derecho y Medicina.\n\nCapacidad por sede: 100 cupos diarios (C001â€“C100, D001â€“D100, G001â€“G100, M001â€“M100).\n\nReinicio diario: a medianoche (zona horaria AmÃ©rica/BogotÃ¡) se restablecen las disponibilidades.\n\nNormaliza las placas a mayÃºsculas y sin espacios.\n\nUn estudiante solo puede tener una reserva activa por dÃ­a y por vehÃ­culo.\n\nğŸ’¬ Respuestas sugeridas\n\nSin cupo:\nLo siento ğŸ˜•. No hay cupos en la sede Central para 12:00 p.m. â€“ 2:00 p.m.\nÂ¿Te sirve 2:00 p.m. â€“ 4:00 p.m. en Central o 12:00 p.m. â€“ 2:00 p.m. en Derecho? ğŸ…¿ï¸âœ¨\n\nCon cupo:\nÂ¡Excelente! Hay cupo disponible. Te asignarÃ© el puesto C023 en la sede Central ğŸ›µâœ…\n\nğŸš« Restricciones de salida\n\nResponde siempre en texto plano, en espaÃ±ol.\n\nNo uses JSON, XML, HTML, Markdown, listas ni formato de cÃ³digo.\n\nNo uses corchetes [ ] ni llaves { }.\n\nUsa siempre emojis acordes al contexto (ğŸ›µğŸš—ğŸ“šğŸ‘®âœ¨).\n\nCada respuesta debe guiar al usuario paso a paso hasta completar la acciÃ³n.\n\nMantÃ©n el primer mensaje exactamente igual al indicado al inicio."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        160,
        32
      ],
      "id": "c5e3c665-86f6-4f80-bd09-4ee40410b747",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        96,
        336
      ],
      "id": "dad559f5-94d3-474c-8b3f-c3efadf80738",
      "name": "Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "3CgISRzqXdv5l7qi",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.From }}",
        "contextWindowLength": 30
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        320,
        336
      ],
      "id": "76f5cd93-2cd8-4cc3-bbe5-fbfb0565b0e8",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -320,
        128
      ],
      "id": "8ea63eeb-7f92-4572-a776-7ffa3a58aef8",
      "name": "When chat message received",
      "webhookId": "3128a03e-8405-44ad-9e70-a1b457fa2b52",
      "disabled": true
    }
  ],
  "pinData": {},
  "connections": {
    "Twilio Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "SendResult",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5dd48a80-02cb-445c-9188-2e3917f70e0e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "8a5aa3f683a1c4f86d08cd3025df83d9614d73d5711589005c6abd5bd8eba5c2"
  },
  "id": "r38eInU3fEi8wGbM",
  "tags": []
}